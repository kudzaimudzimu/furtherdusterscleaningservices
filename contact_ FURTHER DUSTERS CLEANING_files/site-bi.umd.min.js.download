!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("site-bi",[],t):"object"==typeof exports?exports["site-bi"]=t():e["site-bi"]=t()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var e={721:(e,t,n)=>{n.r(t),n.d(t,{ConsentPolicyAccessor:()=>h});var o,i={policy:"getCurrentConsentPolicy",header:"_getConsentPolicyHeader",isMethod:!0},r={policy:"consentPolicy",header:"consentPolicyHeader",isMethod:!1},s={essential:!0,dataToThirdParty:!0,advertising:!0,functional:!0,analytics:!0};function a(){return window}function u(){return self}function c(){return n.g}function l(){return globalThis}function f(e){var t;void 0===e&&(e=void 0),e&&(o=e),o||e||[l,c,u,a].forEach((function(e){try{o||(o=e())}catch(e){}}));try{"object"==typeof o.commonConfig&&o.commonConfig.consentPolicy&&(t=d(o.commonConfig,r)),t||"object"!=typeof o.consentPolicyManager||(t=d(o.consentPolicyManager,i)),t||"object"!=typeof o.Wix||"object"!=typeof o.Wix.Utils||"function"!=typeof o.Wix.Utils.getCurrentConsentPolicy||(t=d(o.Wix.Utils,i))}catch(e){}return t}function d(e,t){return{getCurrentConsentPolicy:function(){var n=e[t.policy];return t.isMethod?n():n},_getConsentPolicyHeader:function(){var n=e[t.header];return t.isMethod?n():n},deleteReference:!t.isMethod}}var h=function(){function e(e){e&&(this.env=e),this.consentPolicyAccess=f(this.env)}return e.prototype.clearReference=function(){this.consentPolicyAccess&&this.consentPolicyAccess.deleteReference&&(this.consentPolicyAccess=void 0)},e.prototype.getCurrentConsentPolicy=function(){this.consentPolicyAccess||(this.consentPolicyAccess=f(this.env));var e=this.consentPolicyAccess&&this.consentPolicyAccess.getCurrentConsentPolicy()||s;return this.clearReference(),e.policy?e.policy:e},e.prototype.getConsentPolicyHeader=function(e){void 0===e&&(e=!1),this.consentPolicyAccess||(this.consentPolicyAccess=f(this.env));var t=this.consentPolicyAccess&&this.consentPolicyAccess._getConsentPolicyHeader()||{"consent-policy":""};return this.clearReference(),e?t["consent-policy"]:t},e}()},433:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultCommonConfig=t.BrandToHostMap=t.HeadlessHost=t.DefaultBrand=t.EventContextMap=t.BackofficeDomains=t.LoggerVersion=void 0,t.LoggerVersion="2.0.985|C",t.BackofficeDomains=[".wix.com",".editorx.com"],function(e){e.msid="_msid",e.clientId="_client_id",e.uuid="_uuid",e.visitorId="_visitorId",e.siteMemberId="_siteMemberId",e.brandId="_brandId",e.siteBranchId="_siteBranchId",e.ms="_ms",e.lv="_lv",e.isHeadless="_isHeadless",e.hostingPlatform="_hostingPlatform"}(t.EventContextMap||(t.EventContextMap={})),t.DefaultBrand="wix",t.HeadlessHost="VIEWER_HEADLESS",t.BrandToHostMap={wix:"wix",editorx:"editorx"},t.DefaultCommonConfig={brand:t.DefaultBrand}},765:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ok=t.object=t.defined=void 0;var o=n(539);t.defined=function(e,t){if(void 0===e)throw new o.AssertionError(t)};t.object=function(e,t){if(void 0!==e&&("object"!=typeof e||Array.isArray(e)||null===e))throw new o.AssertionError(t)};t.ok=function(e,t){if(!e)throw new o.AssertionError(t)}},599:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readCookie=t.sendBeacon=t.getWindowSize=t.getDesktopSize=t.now=void 0,t.now=function(){return"undefined"!=typeof performance&&performance&&performance.now?performance.now():-1},t.getDesktopSize=function(e){var t=e.screen&&e.screen.width||0,n=e.screen&&e.screen.height||0;return"".concat(t,"x").concat(n)},t.getWindowSize=function(e){var t=0,n=0;return e.innerWidth?(t=e.innerWidth,n=e.innerHeight):e.document&&(e.document.documentElement&&e.document.documentElement.clientWidth?(t=e.document.documentElement.clientWidth,n=e.document.documentElement.clientHeight):e.document.body&&e.document.body.clientWidth&&(t=e.document.body.clientWidth,n=e.document.body.clientHeight)),"".concat(t,"x").concat(n)},t.sendBeacon=function(e,t){return!("undefined"==typeof navigator||!navigator||!navigator.sendBeacon)&&navigator.sendBeacon(e,t)},t.readCookie=function(e){if("undefined"==typeof document)return null;if(window.__ENABLE_COOKIE_READ_OPTIMIZATION__&&window.__BI_cookie_cache&&void 0!==window.__BI_cookie_cache[e])return window.__BI_cookie_cache[e];for(var t=0,n=document.cookie.split(";");t<n.length;t++){for(var o=n[t].split("="),i=o[0],r=o[1];" "===i[0];)i=i.substr(1);if(i===e)return window.__ENABLE_COOKIE_READ_OPTIMIZATION__&&(window.__BI_cookie_cache||(window.__BI_cookie_cache={}),window.__BI_cookie_cache[e]=r),r}return""}},997:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getWixHost=t.getBranchId=t.getBrand=t.getCommonConfigValue=void 0;var o=n(47),i=n(433);t.getCommonConfigValue=function(e,t){return void 0===t&&(t=(0,o.getGlobal)((function(e){return e.Wix&&e.Wix.Utils&&e.Wix.Utils.commonConfig||e.commonConfig}))),(t=t&&"function"==typeof t.getAll?t.getAll():t)&&void 0!==t[e]?t[e]:i.DefaultCommonConfig[e]};t.getBrand=function(e){return(0,t.getCommonConfigValue)("brand",e())};t.getBranchId=function(e){return(0,t.getCommonConfigValue)("branchId",e())};t.getWixHost=function(e){return(0,t.getCommonConfigValue)("host",e())}},47:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getGlobal=t.getWindowIfTop=t.isBackoffice=t.isWebWorker=t.getHost=t.setHost=void 0;var o,i,r=n(433);function s(e){if("undefined"!=typeof window&&window)try{return window.top===window.self?e?e(window):window:null}catch(e){return null}return null}function a(e,t){return void 0===t&&(t=null),"undefined"!=typeof self&&self&&e(self)||t}t.setHost=function(e){o=e},t.getHost=function(e){return void 0===e&&(e=r.DefaultBrand),o||(void 0===i&&(i=a((function(e){return e.location&&e.location.hostname&&(e.location.hostname.match(/\.(wix|editorx)\.com$/)||[])[1]||null}),null)),t=i||r.BrandToHostMap[e]||r.BrandToHostMap[r.DefaultBrand],"frog.".concat(t,".com"));var t},t.isWebWorker=function(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope},t.isBackoffice=function(){return s((function(e){var t=e.document;return r.BackofficeDomains.some((function(e){return-1!==t.location.host.indexOf(e)}))}))},t.getWindowIfTop=s,t.getGlobal=a},539:function(e,t){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(t,"__esModule",{value:!0}),t.APINotSupportedError=t.AssertionError=void 0;var i=function(e){function t(t){var n=e.call(this,t)||this;return n.name=n.constructor.name,n}return o(t,e),t}(Error);t.AssertionError=i;var r=function(e){function t(t){var n=e.call(this,t)||this;return n.name=n.constructor.name,n}return o(t,e),t}(Error);t.APINotSupportedError=r},100:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCommonDefaults=t.getUserDefaults=t.transformDefaults=void 0;var o=n(433),i=n(599),r=n(997),s=n(46);t.transformDefaults=function(e){return Object.keys(e).reduce((function(t,n){return t[o.EventContextMap[n]||n]=e[n],t}),{})};t.getUserDefaults=function(){return(0,s.getCookies)({clientId:"_wixCIDX",uuid:{name:"_wixUIDX",transform:function(e){return"string"==typeof e&&e.split("|")[1]}}})};t.getCommonDefaults=function(e,n){return(0,t.transformDefaults)({brandId:function(){return(0,r.getBrand)(e)},siteBranchId:function(){return(0,r.getBranchId)(e)},ms:function(){return Math.round((0,i.now)())},isHeadless:function(){return a(e)},hostingPlatform:function(){return(0,r.getWixHost)(e)},lv:o.LoggerVersion})};var a=function(e){return(0,r.getWixHost)(e)===o.HeadlessHost||void 0}},322:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.listen=void 0;var o=n(47);function i(e){setTimeout((function(){return(0,o.getWindowIfTop)((function(t){return e(t.location.href)}))}))}function r(e){(0,o.getWindowIfTop)((function(t){var n=t.history;return["pushState","replaceState"].forEach((function(t){!function(e,t,n){if(e&&e[t]){var o=e[t];e[t]=function(){return n.apply(null,arguments),o.apply(e,arguments)}}}(n,t,(function(t,n,o){return e(o)}))}))}))}function s(e){(0,o.getWindowIfTop)((function(t){return t.addEventListener("popstate",(function(){return e(t.location.href)}))}))}t.listen=function(e){(0,o.getWindowIfTop)((function(t){var n=t.document.referrer;[i,r,s].forEach((function(t){return t((function(t){e(n,t),n=t}))}))}))}},116:function(e,t,n){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.getTransformers=t.getPublisher=t.postMessagePublisher=t.xhrPublisher=t.fetchPublisher=t.beaconPublisher=t.imagePublisher=t.resolvePublisher=void 0;var r=n(46),s=n(47),a=n(539),u=n(737),c=n(340),l=function(e){return e.useBatch?"POST":"GET"};function f(e){return void 0===e&&(e={}),function(t,n){void 0===n&&(n={});var o=(0,r.buildBiUrl)(e,t,n);return(0,c.beaconTransport)(o,t,!!n.useBatch).catch((function(){var e=l(n);return n.useBatch?(0,c.fetchTransport)(o,t,e).catch((function(n){return n instanceof a.APINotSupportedError?(0,c.xhrTransport)(o,t,e):Promise.reject(n)})):(0,c.pixelTransport)(o,n.image)}))}}function d(e,t){return void 0===e&&(e={}),function(n,o){void 0===o&&(o={});var i=(0,r.buildBiUrl)(e,n,o),s=l(o);return(0,c.fetchTransport)(i,n,s,t).catch((function(e){return e instanceof a.APINotSupportedError?(0,c.xhrTransport)(i,n,s):Promise.reject(e)}))}}function h(e,t){return void 0===e&&(e={}),function(e){return(0,c.postMessageTransport)(e,t)}}t.resolvePublisher=function(e,t){var n,o;return e.publishMethod===u.PublishMethods.PostMessage?(n=h,o=t&&t[u.PublishMethods.PostMessage]):e.publishMethod===u.PublishMethods.Fetch?(n=d,o=t&&t[u.PublishMethods.Fetch]):n=(0,s.isWebWorker)()?d:f,n(e,o)},t.imagePublisher=function(e){return void 0===e&&(e={}),function(t,n){if(void 0===n&&(n={}),n.useBatch)throw new a.APINotSupportedError("Can't use image publisher to send batched events.");var o=(0,r.buildBiUrl)(e,t,n);return(0,c.pixelTransport)(o,n.image)}},t.beaconPublisher=f,t.fetchPublisher=d,t.xhrPublisher=function(e){return void 0===e&&(e={}),function(t,n){void 0===n&&(n={});var o=(0,r.buildBiUrl)(e,t,n),i=l(n);return(0,c.xhrTransport)(o,t,i)}},t.postMessagePublisher=h,t.getPublisher=function(e,n){return(0,t.resolvePublisher)(e,n)};t.getTransformers=function(e,t){var n,r;t&&("function"!=typeof t&&t.postMessage&&e.publishMethod===u.PublishMethods.PostMessage?r=t.postMessage:"function"==typeof t&&(n=t));return{eventTransformer:n,payloadTransformer:function(t,n){if(n.useBatch){var s=function(t){return(null==t?void 0:t.endpoint)||n.endpoint||e.endpoint};t.e=t.e.map((function(e){var t=e.context,n=i(e,["context"]);return o(o({},n),{f:o(o({},n.f),{_rp:s(t)})})}))}return r?r(t):t}}}},821:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.track=void 0;var o=n(46),i=n(322),r=n(47),s=n(599),a="__isTrackingPageViews__",u="p",c=19,l=3;function f(e){var t=function(e){return e({endpoint:u}).updateDefaults({src:c,evid:l,vsi:(0,o.guid)()}).logger()}(e),n=1;(0,i.listen)((function(e,o){var i=(0,r.getWindowIfTop)((function(e){return{sr:(0,s.getDesktopSize)(e),wr:(0,s.getWindowSize)(e)}})),a=i.sr,u=i.wr;t.log({from:e,to:o,fis:n,sr:a,wr:u}),n=0}))}t.track=function(e,t){void 0===t&&(t={force:!1}),(t.force||!(0,r.isWebWorker)()&&(0,r.isBackoffice)()&&(0,r.getWindowIfTop)((function(e){return!e[a]})))&&((0,r.getWindowIfTop)((function(e){return e[a]=!0})),f(e))}},340:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.postMessageTransport=t.xhrTransport=t.fetchTransport=t.pixelTransport=t.beaconTransport=void 0;var o=n(599),i=n(539);t.beaconTransport=function(e,t,n){return void 0===n&&(n=!1),new Promise((function(i,r){return(0,o.sendBeacon)(e,n?JSON.stringify(t):void 0)?i():r(new Error("Transport Error: Cannot send bi using beacon"))}))},t.pixelTransport=function(e,t){return new Promise((function(n,o){var i=t||new window.Image(0,0);i.onload=function(){return n()},i.onerror=function(){return o(new Error("Transport Error: Cannot send bi using pixel"))},i.src=e}))},t.fetchTransport=function(e,t,n,o){if(void 0===n&&(n="GET"),void 0===o){if("undefined"==typeof fetch)return Promise.reject(new i.APINotSupportedError("fetch"));o=fetch}var r={method:n,credentials:"include"};return"POST"===n?r.body=JSON.stringify(t):r.keepalive=!0,o(e,r).then((function(e){if(!e.ok)throw Error("Transport Error: Cannot send bi using fetch. Status: ".concat(e.status))}))},t.xhrTransport=function(e,t,n){return void 0===n&&(n="GET"),new Promise((function(o,i){var r=new XMLHttpRequest;r.open(n,"".concat(location.protocol).concat(e)),r.onload=o,r.onerror=function(){i(new Error("Transport Error: Cannot send bi using xhr."))},r.withCredentials=!0,"POST"===n?r.send(JSON.stringify(t)):r.send()}))},t.postMessageTransport=function(e,t){void 0===t&&(t=self.postMessage);var n=[e];return"undefined"==typeof WorkerGlobalScope&&n.push("*"),t.apply(self,n)}},46:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.guid=t.buildBiUrl=t.getCookies=void 0;var o=n(599),i=n(47),r=0;t.getCookies=function(e){return Object.keys(e).reduce((function(t,n){var i="string"==typeof e[n]?{name:e[n]}:e[n],r=i.name,s=i.transform,a=(void 0===s?function(e){return e}:s)((0,o.readCookie)(r));return a&&(t[n]=a),t}),{})},t.buildBiUrl=function(e,t,n){var o=e.host,s=void 0===o?"":o,a=e.endpoint,u=void 0===a?"":a;void 0===n&&(n={}),s=(s="function"==typeof s?s():s)||(0,i.getHost)(),u=n.endpoint||u,n.useBatch||(t._=""+(new Date).getTime()+r++);var c=n.useBatch?[]:Object.keys(t).map((function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t[e]))}),[]);return["//".concat(s,"/").concat(u)].concat(c.length?c.join("&"):[]).join("?")},t.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}},647:function(e,t,n){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BiLoggerClientFactory=t.createBatchQueue=t.manager=t.factory=t.Factory=t.setHost=t.EventCategories=t.PublishMethods=void 0;var a=n(746),u=n(721),c=s(n(765)),l=n(116),f=n(997),d=n(47),h=n(737),p=n(100),y=n(737);Object.defineProperty(t,"PublishMethods",{enumerable:!0,get:function(){return y.PublishMethods}}),Object.defineProperty(t,"EventCategories",{enumerable:!0,get:function(){return y.EventCategories}});var v=n(47);Object.defineProperty(t,"setHost",{enumerable:!0,get:function(){return v.setHost}});var g=function(){function e(t){void 0===t&&(t={}),this.options=t,this.commonConfigGetter=function(){},this.initialized=!1,c.ok(!t.publishMethod||-1!==Object.keys(h.PublishMethods).map((function(e){return h.PublishMethods[e]})).indexOf(t.publishMethod),'Unsupported publish method "'.concat(t.publishMethod,'"')),e.consentPolicyAccessor=e.consentPolicyAccessor||new u.ConsentPolicyAccessor,this.loggerClientFactory=(0,a.factory)()}return e.prototype.initFactory=function(){var t=this;if(this.initialized)return this.loggerClientFactory;this.initialized=!0,this.updateDefaults((0,p.getCommonDefaults)(this.commonConfigGetter,e.consentPolicyAccessor)),this.withUserContext((0,p.getUserDefaults)());var n=o(o({},this.options),{host:this.options.host||function(){return(0,d.getHost)((0,f.getBrand)(t.commonConfigGetter))}}),i=(0,l.getPublisher)(n,this.publishFunctions),r=(0,l.getTransformers)(n,this.transformer),s=r.eventTransformer,a=r.payloadTransformer,u=this.loggerClientFactory.addPublisher(i).withConsentPolicyGetter((function(){return e.consentPolicyAccessor.getCurrentConsentPolicy()}));return s&&u.withEventTransformer(s),a&&u.withPayloadTransformer(a),u},e.prototype.withTransformer=function(e){return c.defined(e,"Transformer must be provided"),c.ok("function"==typeof e||e&&"function"==typeof e[h.PublishMethods.PostMessage],"Valid transformer must be provided"),this.transformer=e,this},e.prototype.withPublishFunction=function(e){return c.defined(e,"Publish functions object must be provided"),c.ok(this.options.publishMethod&&this.options.publishMethod!==h.PublishMethods.Auto,"Publish function can be used only when using a custom publish method"),c.ok(e&&"function"==typeof e[this.options.publishMethod],"Valid publish function must be provided"),this.publishFunctions=e,this},e.prototype.withUserContext=function(e){return c.defined(e,"User context object must be provided"),this.updateDefaults((0,p.transformDefaults)(e)),this},e.prototype.withUoUContext=function(e){return c.defined(e,"UoU context object must be provided"),this.updateDefaults((0,p.transformDefaults)(e)),this},e.prototype.withNonEssentialContext=function(e){return c.defined(e,"Non-essential context object must be provided"),this.loggerClientFactory.updateNonEssentialDefaults((0,p.transformDefaults)(e)),this},e.prototype.withCommonConfigGetter=function(e){return c.defined(e,"Common config getter must be provided"),c.ok("function"==typeof e,"Common config getter must be a function"),this.commonConfigGetter=e,this},e.prototype.updateDefaults=function(e){return this.loggerClientFactory.updateDefaults(e),this},e.prototype.setMuted=function(e){return this.loggerClientFactory.setMuted(e),this},e.prototype.setEvents=function(e){return this.loggerClientFactory.setEvents(e),this},e.prototype.setGlobalBatchQueue=function(e){return this.loggerClientFactory.setGlobalBatchQueue(e),this},e.prototype.onError=function(e){return this.loggerClientFactory.setPublisherFailHandler(e),this},e.prototype.logger=function(e){void 0===e&&(e={});var t=this.options,n=t.endpoint,i=t.useBatch;return this.initFactory().logger(o({endpoint:n,useBatch:i},e))},e}();t.Factory=g;t.factory=function(e){return void 0===e&&(e={}),new g(e)},t.manager=a.manager,t.createBatchQueue=a.createBatchQueue,t.BiLoggerClientFactory=a.BiLoggerFactory},832:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BiLoggerClientFactory=t.EventCategories=t.createBatchQueue=t.manager=t.setHost=t.factory=void 0;var s=n(746),a=r(n(821)),u=r(n(647));t.factory=function(e){void 0===e&&(e={});var t=e.trackSession||void 0===e.trackSession;return t&&a.track(u.factory,{force:"force"===t}),u.factory(e)},t.setHost=u.setHost,t.manager=s.manager,t.createBatchQueue=s.createBatchQueue,t.EventCategories=u.EventCategories,t.BiLoggerClientFactory=u.BiLoggerClientFactory,t.default={factory:t.factory,setHost:u.setHost,manager:s.manager,createBatchQueue:s.createBatchQueue,EventCategories:u.EventCategories,BiLoggerClientFactory:u.BiLoggerClientFactory}},737:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Errors=t.EventCategories=t.PublishMethods=void 0,function(e){e.Auto="auto",e.PostMessage="postMessage",e.Fetch="fetch"}(t.PublishMethods||(t.PublishMethods={})),function(e){e.Essential="essential",e.Functional="functional",e.Analytics="analytics"}(t.EventCategories||(t.EventCategories={})),function(e){e[e.Unsupported=0]="Unsupported"}(t.Errors||(t.Errors={}))},223:e=>{var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=n.constructor.name,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Error),t}();e.exports.defined=function(e,t){if(void 0===e)throw new n(t)},e.exports.object=function(e,o){if(void 0!==e&&("object"!==(void 0===e?"undefined":t(e))||Array.isArray(e)||null===e))throw new n(o)},e.exports.ok=function(e,t){if(!e)throw new n(t)},e.exports.func=function(e,t){if(void 0!==e&&"function"!=typeof e)throw new n(t)},e.exports.boolean=function(e,t){if(void 0!==e&&"boolean"!=typeof e)throw new n(t)},e.exports.number=function(e,t){if(void 0!==e&&"number"!=typeof e)throw new n(t)},e.exports.array=function(e,t){if("function"==typeof Array.isArray){if(!Array.isArray(e))throw new n(t)}else if("[object Array]"!==Object.prototype.toString.call(e))throw new n(t)},e.exports.AssertionError=n},619:(e,t,n)=>{var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(223),s=n(898),a=n(374),u=n(751),c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._publishers=[],this._validators=[],this._defaults={},this._nonEssentialDefaults={},this._events={},this._isMuted=!1,this._eventTransformer=null,this._payloadTransformer=null,this._consentPolicyGetter=null,this._maxBatchSize=null,this._batchQueue=null}return i(e,[{key:"addPublisher",value:function(e){return r.defined(e,"Publisher must be provided"),r.ok("function"==typeof e,"Expected a publisher function"),this._publishers.push(e),this}},{key:"addValidator",value:function(e){return r.defined(e,"Validator must be provided"),r.ok("object"===(void 0===e?"undefined":o(e))&&e,"Expected a validator object"),r.ok(e.execute&&e.match,"Provided validator does not match the interface"),this._validators.push(e),this}},{key:"setDefaults",value:function(e){return r.defined(e,"Defaults must be provided"),r.object(e,"Defaults must be an object"),this._defaults=e,this}},{key:"updateDefaults",value:function(e){return r.defined(e,"Defaults must be provided"),r.object(e,"Defaults must be an object"),Object.assign(this._defaults,e),this}},{key:"updateNonEssentialDefaults",value:function(e){return r.defined(e,"Non-essential Defaults must be provided"),r.object(e,"Non-essential Defaults must be an object"),Object.assign(this._nonEssentialDefaults,e),this}},{key:"setEvents",value:function(e){return r.defined(e,"Events must be provided"),r.object(e,"Events must be an object"),this._events=e,this}},{key:"setDefaultValueTimeout",value:function(e){return r.defined(e,"Default Value Timeout must be provided"),this._defaultValueTimeout=e,this}},{key:"setDefaultContinueOnFail",value:function(e){return r.defined(e,"Default Continue On Fail must be provided"),this._defaultContinueOnFail=e,this}},{key:"setPublisherFailHandler",value:function(e){return r.defined(e,"Publisher Fail Handler must be provided"),this._onPublisherFailHandler=e,this}},{key:"setMuted",value:function(e){return r.defined(e,"Is Muted must be provided"),r.boolean(e,"Is Muted must be a boolean"),this._isMuted=e,this}},{key:"setMaxBatchSize",value:function(e){return r.defined(e,"Max Batch Size must be provided"),r.number(e,"Max Batch Size must be a number"),r.ok(e>0,"Max Batch Size must be higher than 0"),this._maxBatchSize=e,this}},{key:"setGlobalBatchQueue",value:function(e){return r.defined(e,"Global Batch Queue must be provided"),r.ok(e instanceof u,"Global Batch Queue must be an instance of BatchQueue"),this._globalBatchQueue=e,this}},{key:"withEventTransformer",value:function(e){return r.defined(e,"Event Transformer must be provided"),r.func(e,"Event Transformer must be a function"),this._eventTransformer=e,this}},{key:"withPayloadTransformer",value:function(e){return r.defined(e,"Payload Transformer must be provided"),r.func(e,"Payload Transformer must be a function"),this._payloadTransformer=e,this}},{key:"withConsentPolicyGetter",value:function(e){return r.defined(e,"Consent Policy Getter must be provided"),r.func(e,"Consent Policy Getter must be a function"),this._consentPolicyGetter=e,this}},{key:"logger",value:function(e){var t=this,n=new s({publishers:this._publishers,validators:this._validators,defaults:this._defaults,events:this._events,defaultValueTimeout:this._defaultValueTimeout,defaultContinueOnFail:this._defaultContinueOnFail,onPublisherFailHandler:this._onPublisherFailHandler,isMuted:function(){return t._isMuted},eventTransformer:this._eventTransformer,payloadTransformer:this._payloadTransformer,consentPolicyGetter:this._consentPolicyGetter,nonEssentialDefaults:this._nonEssentialDefaults,maxBatchSize:this._maxBatchSize,globalBatchQueue:this._globalBatchQueue},e);return a.manager.notifyLoggerCreated(n),n}}]),e}();e.exports=c},374:(e,t,n)=>{var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=n(223),r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.reset()}return o(e,[{key:"reset",value:function(){this._handlers=[]}},{key:"onLoggerCreated",value:function(e){var t=this;return i.defined(e,"Handler must be provided."),i.func(e,"Handler must be a function."),this._handlers.push(e),function(){var n=t._handlers.indexOf(e);-1!==n&&t._handlers.splice(n,1)}}},{key:"notifyLoggerCreated",value:function(e){this._handlers.forEach((function(t){return t(e)}))}}]),e}();e.exports={manager:new r,BiLoggerManager:r}},898:(e,t,n)=>{var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(223),s=n(532),a=s.mapValues,u=s.filterValues,c=n(603),l=n(756),f=n(751),d=n(155),h=d.shouldMuteByCategory,p=d.shouldMuteNonEssentials,y=d.getPolicy,v=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._publishers=t.publishers,this._validators=t.validators||[],this._defaults=t.defaults,this._ownDefaults={},this._events=t.events||{},this._context=n||{},this._defaultValueTimeout=t.defaultValueTimeout||5e3,this._defaultContinueOnFail=t.defaultContinueOnFail||!1,this._onPublisherFailHandler=t.onPublisherFailHandler||e._defaultPublisherFailHandler,this._isMuted=t.isMuted||function(){return!1},this._eventTransformer=t.eventTransformer||function(e){return e},this._payloadTransformer=t.payloadTransformer||function(e){return e},this._consentPolicyGetter=t.consentPolicyGetter||function(){return null},this._nonEssentialDefaults=t.nonEssentialDefaults||{},this._maxBatchSize=t.maxBatchSize||100,this._globalBatchQueue=t.globalBatchQueue}return i(e,[{key:"report",value:function(e){r.defined(e,"Data must be provided"),r.object(e,"Data must be an object");var t=e.src,n=e.evid,i=e.params,s=function(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}(e,["src","evid","params"]);return this.log(o({src:t,evid:n},i),s)}},{key:"log",value:function(e,t,n){var i=this;r.defined(e,"Event object or event key must be provided.");var s=this._extractEventAndContext(e,t,n),a=s.event,u=s.context,c=y(this._consentPolicyGetter),l=o({},this._context,u);if(this._isMuted()||h(c,l.category))return Promise.resolve();if(l.useBatch){var f=this._initQueue(l,c),d=function(e){var t=i._eventTransformer(e,l);return f.feed(t,l)};if(this._globalBatchQueue)return this._getDefaults(this._defaults).then((function(e){var t=o({},e,i._getDynamicNonEssentialDefaults(c),i._getStaticNonEssentialDefaults(c),a,i._getPolicyFields(c,l.category));return d(t)}));var p=o({},this._getDynamicDefaults(this._defaults),this._getDynamicNonEssentialDefaults(c),a,this._getPolicyFields(c,l.category));return d(p)}return this._getDefaults(this._defaults).then((function(e){var t=Object.assign(e,i._getDynamicNonEssentialDefaults(c),i._getStaticNonEssentialDefaults(c),a,i._getPolicyFields(c,l.category));if(!(0===i._validators.length||i._validators.some((function(e){return e.match(t)&&(e.execute(t)||!0)}))))throw new Error("No validator accepted the event. Source: "+t.src+" Evid: "+(t.evid||t.evtId));var n=i._eventTransformer(t,l);return n=i._payloadTransformer(n,l),i._send(n,l)}))}},{key:"flush",value:function(){return this._queue?this._queue.flush():Promise.resolve()}},{key:"updateDefaults",value:function(e){return r.defined(e,"Defaults must be provided"),r.object(e,"Defaults must be an object"),Object.assign(this._ownDefaults,e),this}},{key:"_send",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Promise.all(this._publishers.map((function(i){var r=o({},e);return Promise.resolve().then((function(){return i(r,n)})).catch((function(n){return t._onPublisherFailHandler(n,{publisherName:i.name,payload:e})}))}))).then((function(){}))}},{key:"_extractEventAndContext",value:function(e,t,n){var i=void 0,s={};if("string"!=typeof e)i=e,s=t||s;else{if(!(i=this._events[e]))throw new r.AssertionError("Event with key '"+e+"' not found in event map.");t&&(i=o({},i,t),s=n||s)}return{event:i,context:s}}},{key:"_initQueue",value:function(e,t){var n=this;if(this._queue)return this._queue;this._queue=this._globalBatchQueue||new f;return this._queue.init({delayMs:!0===e.useBatch?300:e.useBatch,maxBatchSize:this._maxBatchSize,useThrottle:!!this._globalBatchQueue,optimizeBatch:!!this._globalBatchQueue},(function(o){n._globalBatchQueue||(o.g=Object.assign(n._getStaticDefaults(n._defaults),n._getStaticNonEssentialDefaults(t)));var i=n._payloadTransformer(o,e);return n._send(i,e)})),this._queue}},{key:"_handleDefaultsError",value:function(e){return this._defaultContinueOnFail?(l.error(e),null):Promise.reject(e)}},{key:"_getDynamicNonEssentialDefaults",value:function(e){if(!p(e))return this._getDynamicDefaults(this._nonEssentialDefaults)}},{key:"_getStaticNonEssentialDefaults",value:function(e){if(!p(e))return this._getStaticDefaults(this._nonEssentialDefaults)}},{key:"_withOwnDefaults",value:function(e){return Object.assign({},e,this._ownDefaults)}},{key:"_getDynamicDefaults",value:function(e){e=this._withOwnDefaults(e);var t=u(e,(function(e){return"function"==typeof e}));return a(t,(function(e){return e()}))}},{key:"_getStaticDefaults",value:function(e){return e=this._withOwnDefaults(e),u(e,(function(e){return"function"!=typeof e}))}},{key:"_getDefaults",value:function(e){var t=this;if(!(e=this._withOwnDefaults(e)))return Promise.resolve({});var n=a(e,(function(e,n){if("function"==typeof e)try{e=e()}catch(e){return t._handleDefaultsError(e)}return e&&"function"==typeof e.then?c.timedPromise(e,{message:"Cannot get default value '"+n+" for BI Event'",timeout:t._defaultValueTimeout}).catch((function(e){return t._handleDefaultsError(e)})):e}));return c.allAsObject(n)}},{key:"_encodePolicyValue",value:function(e,t){return e?"boolean"==typeof e[t]?e[t]?1:0:e[t]:1}},{key:"_getPolicyFields",value:function(e,t){return{_isca:this._encodePolicyValue(e,"analytics"),_iscf:this._encodePolicyValue(e,"functional"),_ispd:e.__default?1:0,_ise:"essential"===t?1:0}}}],[{key:"_defaultPublisherFailHandler",value:function(e,t){return t.publisherName}}]),e}();e.exports=v},155:e=>{var t={functional:!0,analytics:!0,__default:!0},n=function(e){return!1===e.functional||!1===e.analytics};e.exports={shouldMuteNonEssentials:n,shouldMuteByCategory:function(e,t){return"essential"!==t&&("functional"===t||"analytics"===t?!1===e[t]:n(e))},getPolicy:function(e){return"function"==typeof e&&e()||t}}},746:(e,t,n)=>{var o=n(619),i=n(898),r=n(374),s=n(751);e.exports.BiLoggerFactory=o,e.exports.BiLogger=i,e.exports.BiLoggerManager=r.BiLoggerManager,e.exports.factory=function(){return new o},e.exports.manager=r.manager,e.exports.createBatchQueue=function(){return new s}},751:(e,t,n)=>{var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,i=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{!o&&a.return&&a.return()}finally{if(i)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};var s=n(854),a=n(959),u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initilized=!1}return o(e,[{key:"_reset",value:function(){var e=this;this._startTime=Date.now(),this._resolve=null,this._promise=new Promise((function(t){return e._resolve=t}))}},{key:"init",value:function(e,t){var n=this,o=e.delayMs,i=e.maxBatchSize,r=e.useThrottle,u=e.optimizeBatch;this._initilized||(this._maxBatchSize=i,this._optimizeBatch=u,this._queue=[],this._flushHandler=t,this._flushDebounced=r?a((function(){return n.flush()}),o):s((function(){return n.flush()}),o),this._initilized=!0,this._reset())}},{key:"flush",value:function(){if(!this._queue.length)return Promise.resolve();var e=this._queue.splice(0,this._queue.length),t=this._resolve,n=this._startTime;this._reset();var o=function(e,t){return{dt:Date.now()-t,e,g:{}}}(e,n);return this._optimizeBatch&&(o=function(e){var t={},n=e.e.length,o=e.e.map((function(e){var n=Object.keys(e.f).map((function(n){var o=e.f[n],i=n+"|"+o;return t[i]=t[i]||0,t[i]++,[n,o,i]}));return r({},e,{f:n})})),s={};return o=o.map((function(e){var o=e.f.reduce((function(e,o){var r=i(o,3),a=r[0],u=r[1],c=r[2];return t[c]===n?s[a]=u:e[a]=u,e}),{});return r({},e,{f:o})})),r({},e,{e:o,g:s})}(o)),this._flushHandler(o).then(t)}},{key:"feed",value:function(e,t){return this._queue.push(function(e,t,n){return{dt:Date.now()-n,f:e,context:t}}(e,t,this._startTime)),this._queue.length===this._maxBatchSize?this.flush():(this._flushDebounced(),this._promise)}}]),e}();e.exports=u},532:e=>{e.exports.mapValues=function(e,t){return e?Object.keys(e).reduce((function(n,o){return n[o]=t(e[o],o,e),n}),{}):{}},e.exports.filterValues=function(e,t){return e?Object.keys(e).reduce((function(n,o){return t(e[o],o,e)&&(n[o]=e[o]),n}),{}):{}}},854:e=>{e.exports=function(e,t,n){var o=void 0;return function(){var i=this,r=arguments,s=n&&!o;clearTimeout(o),o=setTimeout((function(){o=null,n||e.apply(i,r)}),t),s&&e.apply(i,r)}}},756:e=>{e.exports={error:function(){var e;console&&console.error&&(e=console).error.apply(e,arguments)}}},603:e=>{e.exports.timedPromise=function(e,t){var n=t.message,o=t.timeout,i=new Promise((function(e,t){setTimeout(t,o,n?"Timeout: "+n:"Timeout")}));return Promise.race([e,i])},e.exports.allAsObject=function(e){var t=Object.keys(e);return Promise.all(t.map((function(t){return e[t]}))).then((function(e){return e.reduce((function(e,n,o){return e[t[o]]=n,e}),{})}))}},959:e=>{e.exports=function(e,t){var n=void 0;return function(){for(var o=arguments.length,i=Array(o),r=0;r<o;r++)i[r]=arguments[r];n||(n=setTimeout((function(){e.apply(void 0,i),n=null}),t))}}}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{n.r(o),n.d(o,{report:()=>E});let e=1;var t=n(832),i=n.n(t),r={};function s(){const e="undefined"!=typeof $wixContext&&$wixContext.initWixModules?$wixContext.initWixModules:void 0!==globalThis.__wix_context__&&globalThis.__wix_context__.initWixModules?globalThis.__wix_context__.initWixModules:void 0;if(e)return{initWixModules:(t,n)=>a((()=>e(t,n))),fetchWithAuth(){throw new Error("fetchWithAuth is not available in this context")},graphql(){throw new Error("graphql is not available in this context")}};const t="undefined"!=typeof $wixContext?$wixContext.client:void 0!==r.client?r.client:void 0!==globalThis.__wix_context__?globalThis.__wix_context__.client:void 0,n="undefined"!=typeof $wixContext?$wixContext.elevatedClient:void 0!==r.elevatedClient?r.elevatedClient:void 0!==globalThis.__wix_context__?globalThis.__wix_context__.elevatedClient:void 0;return t||n?{initWixModules(e,o){if(o){if(!n)throw new Error("An elevated client is required to use elevated modules. Make sure to initialize the Wix context with an elevated client before using elevated SDK modules");return a((()=>n.use(e)))}if(!t)throw new Error("Wix context is not available. Make sure to initialize the Wix context before using SDK modules");return a((()=>t.use(e)))},fetchWithAuth:(e,n)=>{if(!t)throw new Error("Wix context is not available. Make sure to initialize the Wix context before using SDK modules");return t.fetchWithAuth(e,n)},getAuth(){if(!t)throw new Error("Wix context is not available. Make sure to initialize the Wix context before using SDK modules");return t.auth},async graphql(e,n,o){if(!t)throw new Error("Wix context is not available. Make sure to initialize the Wix context before using SDK modules");return t.graphql(e,n,o)}}:void 0}function a(e){const t=globalThis.__wix_context__,n={client:r.client,elevatedClient:r.elevatedClient};let o;globalThis.__wix_context__=void 0,r.client=void 0,r.elevatedClient=void 0,"undefined"!=typeof $wixContext&&(o={client:$wixContext?.client,elevatedClient:$wixContext?.elevatedClient},delete $wixContext.client,delete $wixContext.elevatedClient);try{return e()}finally{globalThis.__wix_context__=t,r.client=n.client,r.elevatedClient=n.elevatedClient,"undefined"!=typeof $wixContext&&($wixContext.client=o.client,$wixContext.elevatedClient=o.elevatedClient)}}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=u(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==u(t)?t:t+""}function l(e,t,n){return(t=c(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const f="bSession",d=[".wix.com",".editorx.com"];let h=function(e){return e.Functional="functional",e.Analytics="analytics",e}({});const p=e=>!(null!=e&&e.policy)||!1!==e.policy[h.Analytics]&&!1!==e.policy[h.Functional],y=e=>{const t=RegExp("^\\s*"+e+"=\\s*(.*?)\\s*$");let n=[];try{n=window.document.cookie.split(";")}catch(e){}for(const e of n){const n=e.match(t);if(n)return n[1]}return null},v=(e,t,n,o,i)=>{const r=`${e}=${t}; expires=${new Date(n).toUTCString()}; path=${o}; domain=${i}; SameSite=None; Secure`;try{window.document.cookie=r}catch(e){}},g=(e,t,n)=>{v(e,null,0,t,n)};let b;const m=()=>{if(!b){const e=d.reduce(((e,t)=>e||-1===window.document.location.hostname.indexOf(t)?e:t),null);b=e||window.document.location.hostname}return b};class _{constructor(e,t,n){void 0===t&&(t=()=>({read:y,write:v,destroy:g})),void 0===n&&(n={}),this.configStorage=e,this.getCookieReaderWriter=t,this.options=n}checkPolicyAndDestroyIfNeeded(){return!!p(this.configStorage.getPolicy())||(this.destroy(),!1)}get(){return this.checkPolicyAndDestroyIfNeeded()?this.getCookieReaderWriter().read(f):null}set(e){if(!this.checkPolicyAndDestroyIfNeeded())return{bsi:null,ttl:null};const t=Date.now(),n=Math.min(t+18e5,new Date(Date.now()+864e5).setHours(0,0,0,0)),o=this.options.cookieDomain??m();return this.getCookieReaderWriter().write(f,`${e}`,n,"/",o),{bsi:e,ttl:n-t}}destroy(){this.getCookieReaderWriter().destroy(f,"/",this.options.cookieDomain??m());try{window.localStorage.removeItem("beatSessionTs"),window.localStorage.removeItem("beatSessionId")}catch(e){}}}class w{constructor(e,t){this.getCommonConfig=e,this.getConsentPolicy=t,l(this,"bsi",null)}checkPolicyAndDestroyIfNeeded(){return!!p(this.getPolicy())||(this.call("get","bsi")&&this.destroy(),!1)}call(e){const t=this.getCommonConfig();for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return t&&"function"==typeof t[e]&&t[e](...o)}getPolicy(){const e=this.call("get","consentPolicy");return e?{policy:e}:"function"==typeof this.getConsentPolicy?this.getConsentPolicy():null}get(){return this.checkPolicyAndDestroyIfNeeded()&&this.call("get","bsi")||null}set(e){return this.checkPolicyAndDestroyIfNeeded()?(e!==this.call("get","bsi")&&(this.bsi=e,this.call("set","bsi",e)),e):null}subscribe(e){return this.call("subscribe",(()=>{const t=this.call("get","bsi");t!==this.bsi&&(this.bsi=t,e(t))})),this}destroy(){this.bsi=null,this.call("set","bsi",null)}}class x{constructor(e){this.options=e,l(this,"api",void 0),l(this,"cookie",void 0),l(this,"config",void 0),l(this,"consentPolicyChangedListener",void 0),l(this,"initialized",!1),l(this,"session",void 0),l(this,"ttlTimeout",void 0)}static create(e,t){return new x(t).init(e)}isCachedSessionValid(e,t){const n=this.config.getPolicy();return Date.now()<e.cacheExpires&&e.pageNumber===t&&[h.Analytics,h.Functional].every((t=>{var o,i;return(null==(o=e.policy)?void 0:o[t])===(null==n||null==(i=n.policy)?void 0:i[t])}))}createSessionObject(e,t,n){var o,i;void 0===t&&(t=null);const[r=this.api.generateGuid(),s="1"]=t?t.split("|"):[],{baseGlobalPageNumber:a=parseInt(s,10),baseSessionPageNumber:u=e}=n||{};return{bsi:r,pageNumber:e,baseGlobalPageNumber:a,baseSessionPageNumber:u,bsiString:`${r}|${a+e-u}`,policy:{...null==(o=this.config.getPolicy())?void 0:o.policy},cacheExpires:Date.now()+((null==(i=this.options)?void 0:i.cacheTtl)??1e4)}}extend(e){const{bsiString:t,pageNumber:n}=e,{bsi:o,ttl:i}=this.cookie.set(t);return this.config.set(o),this.session={...e,bsiString:o},clearTimeout(this.ttlTimeout),i&&(this.ttlTimeout=setTimeout((()=>this.extend(this.createSessionObject(n))),i)),o}createOrExtendSession(e){void 0===e&&(e=1);const t=this.cookie.get()||this.config.get(),n=t?this.createSessionObject(e,t,this.session):this.createSessionObject(e);return this.extend(n)}init(e){var t;return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];n.forEach((t=>{if(!e||"function"!=typeof e[t])throw new Error(`bsiManager: ${String(t)} must be a function`)}))}(e,"generateGuid","getCommonConfig"),this.api=e,this.config=new w(this.api.getCommonConfig,this.api.getConsentPolicy),this.cookie=new _(this.config,this.api.getCookieReaderWriter,{cookieDomain:null==(t=this.options)?void 0:t.cookieDomain}),this.createOrExtendSession(),globalThis.consentPolicyManager&&"function"==typeof globalThis.addEventListener&&(this.consentPolicyChangedListener=()=>{this.createOrExtendSession()},globalThis.addEventListener("consentPolicyChanged",this.consentPolicyChangedListener)),this.initialized=!0,this}destroy(){clearTimeout(this.ttlTimeout),this.consentPolicyChangedListener&&globalThis.removeEventListener("consentPolicyChanged",this.consentPolicyChangedListener)}getBsi(e,t){var n;void 0===e&&(e=1);let{extend:o}=void 0===t?{extend:!0}:t;if(!this.initialized)throw new Error("bsiManager: please call init() first");return o?this.session&&this.isCachedSessionValid(this.session,e)?this.session.bsiString:this.createOrExtendSession(e):(null==(n=this.session)?void 0:n.bsiString)??null}}const P={get:e=>{if(window.commonConfig)return window.commonConfig[e];console.log("[site-bi] Couldn't read from commonConfig because it's missing")},set:(e,t)=>{window.commonConfig?window.commonConfig[e]=t:console.log("[site-bi] Couldn't update commonConfig because it's missing")}},C=x.create({generateGuid:()=>{var e;return(null==(e=window.crypto)?void 0:e.randomUUID())??"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},getCommonConfig:()=>P,getConsentPolicy:()=>window.consentPolicyManager?window.consentPolicyManager.getCurrentConsentPolicy():(console.log("[site-bi] Couldn't get current consent policy because consentPolicyManager is not defined"),{defaultPolicy:!0,policy:{functional:!0,analytics:!0,essential:!0,advertising:!0,dataToThirdParty:!0}})},{cookieDomain:document.location.host.replace(/^www\./,"")}),T=i().factory().withNonEssentialContext({_authToken:()=>{var e;return null==(e=s())?void 0:e.getAuth().getTokens().accessToken.value},bsi:()=>C.getBsi(e)}).logger(),E=e=>T.report((e=>({...e,endpoint:"headless"}))(e));(()=>{const t={report:E};Object.defineProperty(window,"wixBi",{value:Object.freeze(t),writable:!1,configurable:!1,enumerable:!0}),window.addEventListener("wix:bi:navigation",(t=>{var n;n=t.detail.pageNumber,e=n}))})()})(),o})()));
//# sourceMappingURL=site-bi.umd.min.js.map